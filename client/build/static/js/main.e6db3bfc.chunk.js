(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{44:function(e,t,n){e.exports=n(94)},49:function(e,t,n){},51:function(e,t,n){},81:function(e,t){},84:function(e,t,n){},86:function(e,t,n){},88:function(e,t,n){},90:function(e,t,n){},92:function(e,t,n){},94:function(e,t,n){"use strict";n.r(t);var a=n(0),o=n.n(a),i=n(37),r=n.n(i),s=n(96),c=(n(49),n(3)),l=n(4),u=n(6),m=n(5),d=n(7),f=n(95),h=n(97),p=n(38),v=n.n(p),g=n(43),E=function(e){function t(){var e;return Object(c.a)(this,t),(e=Object(u.a)(this,Object(m.a)(t).call(this))).onInputChange=function(t){e.setState({inputValue:t.target.value})},e.onButtonClick=function(){var t=e.state.inputValue;(0,e.props.onClick)(t),e.setState({inputValue:""})},e.handleEnter=function(t){13===(t=t||window.event).keyCode&&e._button.click()},e.getInputRef=function(t){return e._input=t},e.getButtonRef=function(t){return e._button=t},e.state={inputValue:""},e}return Object(d.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){this._input.addEventListener("keyup",this.handleEnter)}},{key:"componentWillUnmount",value:function(){this._input.removeEventListener("keyup",this.handleEnter)}},{key:"render",value:function(){var e=this.state.inputValue,t=this.props,n=t.children,i=(t.onClick,Object(g.a)(t,["children","onClick"]));return o.a.createElement(a.Fragment,null,o.a.createElement("input",Object.assign({type:"text",value:e,onChange:this.onInputChange,ref:this.getInputRef},i)),o.a.createElement("button",{onClick:this.onButtonClick,ref:this.getButtonRef},n))}}]),t}(a.Component),C=(n(51),Object(h.a)(function(e){var t=e.submitName,n=e.roomID,a=e.setRoom,i=e.nameError,r=e.history,s=i.duplicateName,c=i.notValidLength;return o.a.createElement("div",{className:"welcome-fixed"},o.a.createElement("div",{className:"welcome"},"Please, enter your name:",o.a.createElement(E,{placeholder:c?"Invalid name":s?"User already exists":"Nikita",className:s||c?"error":"",onClick:function(e){var o=t(e);if(!n&&o){var i=v()();a(i),r.push("/room/".concat(i))}}},"SUBMIT")))})),S=n(41),k=n.n(S),O=n(42),b=(n(84),function(e){var t=e.text,n=e.unixTime,a=e.user,i=e.myMessage,r="".concat(new Date(n).toTimeString().slice(0,8));return o.a.createElement("li",{className:"msg "+(i?"my-msg":"")},o.a.createElement("header",{className:"msg-header"},a+" at "+r),o.a.createElement("main",{className:"msg-mainText"},t))}),w=(n(86),function(e){function t(){var e;return Object(c.a)(this,t),(e=Object(u.a)(this,Object(m.a)(t).call(this))).sendMessage=function(t){var n=e.props,a=n.name,o=n.socket;if(""!==t&&a){var i={text:t,unixTime:Date.now(),user:a,myMessage:!1};o.emit("message",i)}},e.getRefChatWindow=function(t){return e._chatWindow=t},e.state={messages:[]},e}return Object(d.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.props.socket.on("message",function(t){var n=e.state.messages;e.setState({messages:[].concat(Object(O.a)(n),[t])})}),this._chatWindow.addEventListener("DOMNodeInserted",function(e){var t=e.target;this.scrollTop+t.clientHeight+30>this.scrollHeight-this.clientHeight&&(this.scrollTop=this.scrollHeight)})}},{key:"render",value:function(){var e=this.state.messages;return o.a.createElement("div",{className:"Room-chat"},o.a.createElement("div",{className:"Room-chat-messages",ref:this.getRefChatWindow},o.a.createElement("ul",null,e.map(function(e){var t=e.text,n=e.unixTime,a=e.user,i=e.myMessage;return o.a.createElement(b,{text:t,unixTime:n,user:a,myMessage:i,key:n})}))),o.a.createElement("div",{className:"Room-chat-input"},o.a.createElement(E,{onClick:this.sendMessage,placeholder:"Type here..."},o.a.createElement("i",{className:"fas fa-comment"}))))}}]),t}(a.Component)),N=(n(88),function(e){var t=e.onlineUsers,n=e.closeList;return o.a.createElement("div",{className:"onlineList"},o.a.createElement("header",null,t.length," User(s) Online now:"),o.a.createElement("main",null,o.a.createElement("ul",null,t.map(function(e){return o.a.createElement("li",{className:"onlineList-user",key:e.id},e.name)}))),o.a.createElement("button",{onClick:n},"Close"))}),j=(n(90),function(e){for(var t=[],n=0;n<e;n++)t.push({peerConnection:new RTCPeerConnection(null),id:n});return t}),R=function(e,t,n){var a=t.peerConnection,o=t.id,i=!1;a.addEventListener("negotiationneeded",function(){i||(i=!0,a.createOffer({offerToReceiveVideo:!0,offerToReceiveAudio:!0}).then(function(t){a.setLocalDescription(t),n?e.emit("sdp-creator-offer-end",t,o):e.emit("sdp-creator-offer",t,o)}))}),a.addEventListener("icecandidate",function(t){var n=t.candidate;n&&e.emit("candidate-creator-first",n,o)}),a.addEventListener("signalingstatechange",function(e){i="stable"!==a.signalingState})},y=function(e){function t(){var e;return Object(c.a)(this,t),(e=Object(u.a)(this,Object(m.a)(t).call(this))).startSession=function(){var t=e.props,n=t.usersNum,a=t.socket,o=j(n-1);navigator.mediaDevices.getUserMedia({video:!0,audio:!0}).then(function(t){o.forEach(function(e,n,o){var i=e.peerConnection;t.getTracks().forEach(function(e){return i.addTrack(e,t)}),R(a,e,n===o.length-1)}),e.setState({mediaStream:t,outPeerConnections:o})}).catch(function(e){console.log("navigator.getUserMedia error: ",e)})},e.finishSession=function(){var t=e.state.mediaStream,n=e.props.socket;t.getTracks().forEach(function(e){return e.stop()}),n.emit("close-video"),e.setState({mediaStream:null,outPeerConnections:[],connectedCounter:0})},e.handleVideoShow=function(){e.state.mediaStream?e.finishSession():e.startSession()},e.setVideoToEl=function(t){if(e._videoRef){if(e._videoRef.srcObject)return;e._videoRef.srcObject=t}},e.isAllConnected=function(){var t=e.state,n=t.outPeerConnections;return t.connectedCounter===n.length},e.getVideoRef=function(t){return e._videoRef=t},e.state={mediaStream:null,outPeerConnections:[],minePeerConnection:null,nameSource:null,showStream:!1,connectedCounter:0},e}return Object(d.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=this,t=this.props.socket;t.on("already-streaming",function(t){var n;n=t?{showStream:!0,nameSource:"*anonymous*"}:{showStream:!1,nameSource:null},e.setState(n)}),t.on("sdp-creator-offer",function(n,a){var o,i,r=new RTCPeerConnection(null);new Promise(function(e,n){return t.on("candidate-creator-first",function(t,n,a){r.addIceCandidate(t).catch(function(){return console.log("Error to add IceCandidate, peerID: ",i)}),i=a,e(o=n)})}).then(function(e){r.createAnswer().then(function(n){r.setLocalDescription(n),t.emit("sdp-answer",n,e)})}),r.setRemoteDescription(n).catch(function(){return console.log("Can't to establish connection, peerID: ",i)}),r.addEventListener("iceconnectionstatechange",function(){"failed"!==r.iceConnectionState&&"disconnected"!==r.iceConnectionState&&"closed"!==r.iceConnectionState||(e.setVideoToEl(null),e.setState({showStream:!1,minePeerConnection:null}))}),r.addEventListener("icecandidate",function(e){var n=e.candidate;n&&t.emit("candidate-receiver",n,o,i)}),r.ontrack=function(t){e.setState({showStream:!0}),e.setVideoToEl(t.streams[0])},e.setState({minePeerConnection:r,nameSource:a})}),t.on("sdp-answer",function(n,a){var o=e.state.outPeerConnections;o[a].peerConnection.setRemoteDescription(n).then(function(){e.setState(function(e){return{connectedCounter:++e.connectedCounter}})}).catch(function(){return console.dir("Can't to establish connection, peerID: ",a,o)}),t.on("candidate-receiver",function(e,t,n){o[n].peerConnection.addIceCandidate(e).catch(function(){return console.log("Error addIceCandidate, peerID: ",n)})})}),t.on("close-video",function(){e.setVideoToEl(null),e.setState({showStream:!1,minePeerConnection:null,nameSource:null})})}},{key:"componentDidUpdate",value:function(e,t){var n=this.state.mediaStream;t.mediaStream!==n&&n&&this.setVideoToEl(n)}},{key:"render",value:function(){var e=this.state,t=e.mediaStream,n=e.showStream,a=e.nameSource;return o.a.createElement("div",{className:"video"},t||n?o.a.createElement("div",{className:"video-stream"},a?o.a.createElement("span",{className:"streamer-name"},a," is streaming now"):null,o.a.createElement("video",{autoPlay:!0,ref:this.getVideoRef})):null,n?null:this.isAllConnected()?o.a.createElement("button",{onClick:this.handleVideoShow},t?"Stop streaming":"Start Streaming"):o.a.createElement("i",{className:"fas fa-spinner"}))}}]),t}(a.Component),D=(n(92),function(e){function t(){var e;return Object(c.a)(this,t),(e=Object(u.a)(this,Object(m.a)(t).call(this))).triggerOnlineList=function(){e.setState(function(e){return{showOnlineList:!e.showOnlineList}})},e.state={socket:null,showOnlineList:!1},e}return Object(d.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=this.props,t=e.name,n=e.roomID,a=e.setRoom,o=e.setOnlineUsers,i=k()();this.setState({socket:i});var r=function(e){for(var t=e.props.location.pathname.split("/"),n=t.length-1;n>=0&&""===t[n];n--)t.pop();return t[t.length-1]}(this);n||a(r),i.emit("connectToRoom",n||r,t),i.on("updatedRoom",function(e){var t=e.onlineUsers;o(t)})}},{key:"componentDidUpdate",value:function(e){var t=this.props,n=this.state.socket;e.name!==t.name&&n.emit("addUser",t.name)}},{key:"render",value:function(){var e=this.state,t=e.socket,n=e.showOnlineList,i=this.props,r=i.name,s=i.onlineUsers;return o.a.createElement("div",{className:"Room"},n?o.a.createElement(N,{onlineUsers:s,closeList:this.triggerOnlineList}):null,o.a.createElement("header",{className:"Room-header"},"This is the private chat-room,\xa0",o.a.createElement("span",{className:"span-online",onClick:this.triggerOnlineList},"now Online"),": ",s.length),t?o.a.createElement(a.Fragment,null,o.a.createElement(w,{name:r,socket:t}),o.a.createElement(y,{socket:t,usersNum:s.length})):null)}}]),t}(a.Component)),L=Object(h.a)(D),I=function(e,t){for(var n=0;n<t.length;n++)if(t[n].name===e)return!0;return!1},T=function(e){return!(e.length<20)},U=function(e){function t(){var e;return Object(c.a)(this,t),(e=Object(u.a)(this,Object(m.a)(t).call(this))).submitName=function(t){var n=e.state.onlineUsers,a=I(t,n),o=T(t);return e.setState({nameError:{duplicateName:a,notValidLength:o}}),!(""===t||o||a||a)&&(e.setState({name:t}),!0)},e.setRoom=function(t){e.setState({roomID:t})},e.setOnlineUsers=function(t){e.setState({onlineUsers:t})},e.state={name:null,roomID:null,nameError:{duplicateName:!1,notValidLength:!1},onlineUsers:[]},e}return Object(d.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this,t=this.state,n=t.name,a=t.roomID,i=t.nameError,r=t.onlineUsers;return o.a.createElement("div",{className:"App"},o.a.createElement("div",{className:"container"},o.a.createElement(f.a,{exact:!0,path:"/room/:ID",render:function(){return o.a.createElement(L,{name:n,roomID:a,setRoom:e.setRoom,setOnlineUsers:e.setOnlineUsers,onlineUsers:r})}}),!n||i.duplicateName||i.notValidLength?o.a.createElement(C,{submitName:this.submitName,setRoom:this.setRoom,roomID:a,nameError:i}):null))}}]),t}(a.Component);r.a.render(o.a.createElement(s.a,null,o.a.createElement(U,null)),document.getElementById("root"))}},[[44,2,1]]]);
//# sourceMappingURL=main.e6db3bfc.chunk.js.map